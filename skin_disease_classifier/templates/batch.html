{% extends 'base.html' %}
{% load static %}

{% block title %}Batch Prediction{% endblock %}

{% block content %}

<div class="row justify-content-center mb-5">
    <div class="col-lg-6 text-center">

        <h1 class="section-title">
            <i class="bi bi-images"></i> Batch Image Prediction
        </h1>

        <p class="text-muted-custom">
            Upload multiple skin images for AI diagnosis
        </p>

    </div>
</div>


<div class="row justify-content-center">
    <div class="col-lg-6">

        <!-- Upload Card -->
        <div class="card p-4">

            <form method="POST" enctype="multipart/form-data">
                {% csrf_token %}

                <div class="upload-area text-center p-5 rounded-3 mb-3" id="uploadArea">
                    <i class="bi bi-cloud-arrow-up icon-lg"></i>
                    <p class="fw-600">Click or Drag Multiple Images</p>
                </div>

                {{ form.images }}

                <button class="btn btn-primary w-100">
                    <i class="bi bi-lightning-charge"></i> Process All
                </button>

            </form>

        </div>


        <!-- Results -->
        {% if results %}
        <div class="card mt-4 p-4">

            <h5 class="mb-4 text-success text-center">
                <i class="bi bi-check-circle"></i> Batch Results
            </h5>

            <table class="table table-bordered text-center">
                <thead>
                    <tr>
                        <th>Image</th>
                        <th>Prediction</th>
                        <th>Confidence</th>
                    </tr>
                </thead>

                <tbody>
                    {% for r in results %}
                    <tr>
                        <td>{{ r.filename }}</td>
                        <td>{{ r.label }}</td>
                        <td style="width: 40%;">
                            <div class="progress">
                                <div class="progress-bar"
                                     style="width: {{ r.confidence }}%;">
                                </div>
                            </div>
                            {{ r.confidence|floatformat:2 }}%
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

        </div>
        {% endif %}

    </div>
</div>


<script>
const input = document.querySelector('input[type="file"]');
const area = document.getElementById('uploadArea');

area.onclick = () => input.click();
</script>

{% endblock %}
