{% extends 'base.html' %}

{% block title %}Batch Prediction{% endblock %}

{% block content %}

<!-- =========================
     HEADER
========================= -->
<div class="row justify-content-center mb-5">
    <div class="col-lg-6 text-center">

        <h1 class="section-title">
            <i class="bi bi-images"></i> Batch Image Prediction
        </h1>

        <p class="text-muted-custom">
            Upload up to 100 images for AI diagnosis
        </p>

    </div>
</div>



<!-- =========================
     UPLOAD CARD
========================= -->
<div class="row justify-content-center">
    <div class="col-md-6">

        <div class="card p-4">

            <form method="POST" enctype="multipart/form-data">
                {% csrf_token %}

                <!-- Clickable upload area -->
                <div id="uploadArea"
                     style="
                        padding:40px;
                        border:2px dashed #cbd5e1;
                        text-align:center;
                        cursor:pointer;
                        border-radius:8px;
                     ">
                    Click or Upload Images (Max 100)
                </div>

                <!-- Hidden file input -->
                <input type="file"
                       id="batchInput"
                       name="images"
                       multiple
                       accept="image/*"
                       style="display:none;">

                <!-- Selected files info -->
                <div id="fileInfo" class="mt-3 text-center text-muted-custom"></div>

                <button type="submit" class="btn btn-primary w-100 mt-3">
                    Process All
                </button>

            </form>

        </div>



        <!-- =========================
             RESULTS
        ========================== -->
        {% if results %}
        <div class="card mt-4 p-4">

            <h5 class="text-center mb-4">Batch Results</h5>

            <table class="table table-bordered text-center">
                <thead>
                    <tr>
                        <th>Image</th>
                        <th>Prediction</th>
                        <th>Confidence</th>
                    </tr>
                </thead>

                <tbody>
                    {% for r in results %}
                    <tr>
                        <td>{{ r.filename }}</td>
                        <td>{{ r.label }}</td>
                        <td style="width:40%;">

                            <div style="background:#e5e7eb;height:16px;border-radius:6px;overflow:hidden;">
                                <div style="
                                    width: {{ r.confidence }}%;
                                    height:100%;
                                    background:#2563eb;
                                "></div>
                            </div>

                            {{ r.confidence|floatformat:2 }}%
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

        </div>
        {% endif %}

    </div>
</div>



<!-- =========================
     JS
========================= -->
<script>
const input = document.getElementById('batchInput');
const area = document.getElementById('uploadArea');
const info = document.getElementById('fileInfo');

area.onclick = () => input.click();

input.onchange = () => {

    if (input.files.length > 100) {
        alert("Maximum 100 images allowed.");
        input.value = "";
        info.innerText = "";
        return;
    }

    info.innerText = input.files.length + " image(s) selected";
};
</script>

{% endblock %}
