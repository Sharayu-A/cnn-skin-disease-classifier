{% extends 'base.html' %}
{% load static %}

{% block title %}Single Image Prediction{% endblock %}

{% block content %}

<div class="row justify-content-center mb-5">
    <div class="col-lg-8 text-center">
        <h1 class="section-title">
            <i class="bi bi-image"></i> Single Image Prediction
        </h1>
        <p class="text-muted-custom">
            Upload a skin image for AI diagnosis
        </p>
    </div>
</div>


<div class="row justify-content-center">

    <div class="col-lg-6">

        <!-- Upload Card -->
        <div class="card p-4">

            <form method="POST" enctype="multipart/form-data">
                {% csrf_token %}

                <!-- Upload Area -->
                <div class="upload-area text-center p-5 rounded-3 mb-3" id="uploadArea">
                    <i class="bi bi-cloud-arrow-up icon-lg"></i>
                    <p class="fw-600">Click or Drag Image</p>
                </div>

                <!-- Hidden Django input -->
                {{ form.image }}

                <!-- Preview -->
                <div id="previewContainer" class="hidden text-center mb-3">
                    <img id="imagePreview" class="preview-img rounded-3">
                </div>

                <button class="btn btn-primary w-100">
                    <i class="bi bi-lightning-charge"></i> Predict
                </button>

            </form>

        </div>


        <!-- Prediction Result -->
        {% if result %}
        <div class="card mt-4 p-4 text-center shadow-sm">

            <h5 class="mb-3">
                <i class="bi bi-check-circle text-success"></i>
                Prediction Result
            </h5>

            <h4 class="fw-700 text-primary mb-3">
                {{ result.0 }}
            </h4>

            <!-- Confidence Graph -->
            <p class="mb-2 fw-600">
                Confidence: {{ result.1|floatformat:2 }}%
            </p>

            <div class="progress">
                <div
                    class="progress-bar"
                    role="progressbar"
                    style="width: {{ result.1 }}%;"
                    aria-valuenow="{{ result.1 }}"
                    aria-valuemin="0"
                    aria-valuemax="100">
                </div>
            </div>

        </div>
        {% endif %}

    </div>

</div>


<!-- Simple Preview Script (ONLY for preview, not submit) -->
<script>
const fileInput = document.querySelector('input[type="file"]');
const preview = document.getElementById('previewContainer');
const img = document.getElementById('imagePreview');
const area = document.getElementById('uploadArea');

area.onclick = () => fileInput.click();

fileInput.onchange = () => {
    const file = fileInput.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = e => {
        img.src = e.target.result;
        preview.classList.remove('hidden');
    };
    reader.readAsDataURL(file);
};
</script>

{% endblock %}
