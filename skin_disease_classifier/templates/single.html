{% extends 'base.html' %}

{% block title %}Single Prediction{% endblock %}

{% block content %}

<!-- =========================
     HEADER (same as batch)
========================= -->
<div class="row justify-content-center mb-5">
    <div class="col-lg-6 text-center">

        <h1 class="section-title">
            <i class="bi bi-image"></i> Single Image Prediction
        </h1>

        <p class="text-muted-custom">
            Upload a skin image for AI diagnosis
        </p>

    </div>
</div>



<!-- =========================
     UPLOAD CARD
========================= -->
<div class="row justify-content-center">
    <div class="col-md-6">

        <div class="card p-4">

            <form method="POST" enctype="multipart/form-data">
                {% csrf_token %}

                <!-- Upload area -->
                <div class="upload-area text-center mb-3"
                     id="uploadArea"
                     style="padding:40px; border:2px dashed #cbd5e1; cursor:pointer;">
                    Click or Upload Image
                </div>

                {{ form.image }}

                <!-- =========================
                     HARD-CODED PREVIEW (NO CSS)
                ========================== -->
                <div id="previewContainer"
                     class="hidden mt-3"
                     style="text-align:center; overflow:hidden;">

                    <img id="imagePreview"
                         alt="Preview of uploaded image"
                         style="
                             width:100%;
                             max-height:200px;
                             object-fit:contain;
                             border-radius:8px;
                             display:block;
                             margin:auto;
                         ">
                </div>

                <button type="submit" class="btn btn-primary w-100 mt-3">
                    Predict
                </button>

            </form>

        </div>



        <!-- =========================
             RESULT
        ========================== -->
        {% if result %}
        <div class="card p-4 mt-4 text-center">

            <h5 style="font-weight:600;">
                Prediction: {{ result.0 }}
            </h5>

            <!-- confidence bar -->
            <div style="background:#e5e7eb; height:18px; border-radius:6px; overflow:hidden; margin-top:10px;">
                <div style="
                        width: {{ result.1 }}%;
                        height:100%;
                        background:#2563eb;
                    ">
                </div>
            </div>

            <small>{{ result.1 }}%</small>

        </div>
        {% endif %}

    </div>
</div>



<!-- =========================
     PREVIEW JS (UNCHANGED)
========================= -->
<script>
const input = document.querySelector('input[type="file"]');
const area = document.getElementById('uploadArea');
const preview = document.getElementById('previewContainer');
const img = document.getElementById('imagePreview');

area.onclick = () => input.click();

input.onchange = () => {
    const reader = new FileReader();
    reader.onload = e => {
        img.src = e.target.result;
        preview.classList.remove('hidden');
    };
    reader.readAsDataURL(input.files[0]);
};
</script>

{% endblock %}
