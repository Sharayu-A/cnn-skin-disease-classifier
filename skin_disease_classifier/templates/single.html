{% extends 'base.html' %}

{% block title %}Single Prediction{% endblock %}

{% block content %}

<!-- ðŸ”¥ HEADER (same style as batch page) -->
<div class="row justify-content-center mb-5">
    <div class="col-lg-6 text-center">

        <h1 class="section-title">
            <i class="bi bi-image"></i> Single Image Prediction
        </h1>

        <p class="text-muted-custom">
            Upload a skin image for AI diagnosis
        </p>

    </div>
</div>


<div class="row justify-content-center">
    <div class="col-lg-6">

        <div class="card p-4">

            <form method="POST" enctype="multipart/form-data">
                {% csrf_token %}

                <div class="upload-area text-center p-4 mb-3" id="uploadArea">
                    <i class="bi bi-cloud-arrow-up icon-lg"></i>
                    <p class="fw-600">Click or Upload Image</p>
                </div>

                {{ form.image }}

                <div id="previewContainer" class="hidden text-center mt-3">
                    <img id="imagePreview" class="preview-img">
                </div>

                <button type="submit" class="btn btn-primary w-100 mt-3">
                    Predict
                </button>
            </form>

        </div>


        {% if result %}
        <div class="card p-4 mt-4 text-center">

            <h5 class="fw-700 text-success mb-3">
                Prediction: {{ result.0 }}
            </h5>

            <div class="progress">
                <div class="progress-bar"
                     style="width: {{ result.1 }}%;">
                </div>
            </div>

            <small>{{ result.1 }}%</small>

        </div>
        {% endif %}

    </div>
</div>


<script>
const input = document.querySelector('input[type="file"]');
const area = document.getElementById('uploadArea');
const preview = document.getElementById('previewContainer');
const img = document.getElementById('imagePreview');

area.onclick = () => input.click();

input.onchange = () => {
    const reader = new FileReader();
    reader.onload = e => {
        img.src = e.target.result;
        preview.classList.remove('hidden');
    };
    reader.readAsDataURL(input.files[0]);
};
</script>

{% endblock %}
