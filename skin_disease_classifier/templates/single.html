{% extends 'base.html' %}

{% block title %}Single Prediction{% endblock %}

{% block content %}

<div class="row justify-content-center">
    <div class="col-md-6">

        <div class="card p-4">

            <form method="POST" enctype="multipart/form-data">
                {% csrf_token %}

                <div class="upload-area mb-3" id="uploadArea">
                    Click or Upload Image
                </div>

                {{ form.image }}

                <div id="previewContainer" class="hidden mt-3">
                    <img id="imagePreview" class="preview-img" alt="Preview of uploaded skin disease image">
                </div>

                <button type="submit" class="btn btn-primary w-100 mt-3">
                    Predict
                </button>
            </form>

        </div>

        {% if result %}
        <div class="card p-4 mt-4 text-center">
            <h5>{{ result.0 }}</h5>

            <div class="progress mt-2">
                <div class="progress-bar" data-width="{{ result.1|stringformat:'d' }}">
                </div>
            </div>

            <small>{{ result.1 }}%</small>
        </div>
        {% endif %}

    </div>
</div>

<script>
const input = document.querySelector('input[type="file"]');
const area = document.getElementById('uploadArea');
const preview = document.getElementById('previewContainer');
const img = document.getElementById('imagePreview');
const progressBar = document.querySelector('.progress-bar');

area.onclick = () => input.click();

input.onchange = () => {
    const reader = new FileReader();
    reader.onload = e => {
        img.src = e.target.result;
        preview.classList.remove('hidden');
    };
    reader.readAsDataURL(input.files[0]);
};

if (progressBar) {
    progressBar.style.width = progressBar.getAttribute('data-width') + '%';
}
</script>

{% endblock %}
